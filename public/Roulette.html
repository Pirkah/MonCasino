<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Roulette Multi</title>
    <style>
        body{background:#1a1a1a;color:white;text-align:center;font-family:Arial,sans-serif;overflow-x:hidden;user-select:none;}
        .header{display:flex;justify-content:space-between;padding:15px;background:#111;border-bottom:2px solid gold;}
        .solde-box{font-size:24px;color:#2ecc71;font-weight:bold;position:relative;}
        .casino-layout{display:flex;justify-content:center;gap:40px;margin-top:20px;}
        /* ROUE ET TIMER */
        .roulette-wrapper{position:relative;width:380px;height:380px; margin-top: 30px;} 
        .roue{width:100%;height:100%;border-radius:50%;border:10px solid #444;position:relative;transition:transform 5s cubic-bezier(0.1,0,0.2,1);box-shadow:0 0 30px black; overflow:hidden;}
        .fleche{position:absolute;top:-20px;left:50%;transform:translateX(-50%);border-left:20px solid transparent;border-right:20px solid transparent;border-top:40px solid gold;z-index:20;}
        .centre{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:80px;height:80px;background:#222;border-radius:50%;border:4px solid gold;display:flex;justify-content:center;align-items:center;font-size:30px;font-weight:bold;z-index:15;}
        .roue-segment { position: absolute; width: 100%; height: 100%; top: 0; left: 0; pointer-events: none; }
        .roue-text { position: absolute; top: 15px; left: 50%; transform: translateX(-50%); font-size: 14px; font-weight: bold; color: white; text-shadow: 1px 1px 2px black; }
        /* TAPIS */
        .tapis{background:#076324;border:8px solid #3d2b1f;border-radius:10px;padding:15px;position:relative;}
        .grid-num{display:grid;grid-template-columns:50px repeat(12,55px);gap:3px;}
        .case{display:flex;justify-content:center;align-items:center;font-weight:bold;font-size:20px;border:2px solid rgba(255,255,255,0.2);height:60px;cursor:pointer;position:relative;}
        .case:hover{background:rgba(255,255,255,0.3)!important;}
        .zero{grid-row:1/span 3;background:#16a085;} .red{background:#c0392b;} .black{background:#2c3e50;}
        .grid-out{display:grid;grid-template-columns:repeat(3,1fr);gap:5px;margin-top:10px;margin-left:53px;}
        .case-out{padding:15px;border:2px solid rgba(255,255,255,0.2);cursor:pointer;font-weight:bold;font-size:18px;position:relative;}
        .case-out:hover{background:rgba(255,255,255,0.2);}
        .chip{position:absolute;width:30px;height:30px;border-radius:50%;border:2px dashed white;display:flex;justify-content:center;align-items:center;font-size:10px;color:black;font-weight:bold;pointer-events:none;z-index:10;box-shadow:2px 2px 5px black; top: 50%; left: 50%; margin-top: -15px; margin-left: -15px;}
        .chip-enemy{opacity:0.7;background:#aaa!important;}
        .controls{margin-top:20px;display:flex;justify-content:center;gap:20px;}
        .jeton{width:60px;height:60px;border-radius:50%;border:4px dashed white;display:flex;justify-content:center;align-items:center;font-weight:bold;cursor:pointer;}
        .selected{transform:scale(1.1);box-shadow:0 0 15px white;}
        #live-feed{width:250px;height:150px;background:rgba(0,0,0,0.6);position:absolute;right:0;bottom:0;overflow-y:auto;text-align:left;padding:10px;font-size:12px;font-family:monospace;color:#ddd;}
        #msg{font-size:30px;font-weight:bold;height:40px;margin:10px;}
        #timer{font-size:50px;font-weight:bold;color:gold;margin-bottom: 20px;}
        #ecran-pseudo{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);z-index:100;display:flex;justify-content:center;align-items:center;flex-direction:column;}
        input{padding:15px;font-size:20px;} .btn{padding:10px 30px;font-size:20px;background:#2ecc71;color:white;border:none;cursor:pointer;}
        /* Shared */
        .float-money { position: absolute; font-weight: bold; font-size: 32px; animation: floatUp 4s ease-out forwards; z-index: 2000; pointer-events: none; text-shadow: 0 0 10px black; width: 300px; text-align: center; left: 50%; transform: translateX(-50%); }
        @keyframes floatUp { 0% { opacity: 1; top: 20px; transform: translateX(-50%) scale(1); } 100% { opacity: 0; top: -100px; transform: translateX(-50%) scale(1.2); } }
        /* Tchat */
        #chat-wrapper { position: fixed; bottom: 10px; left: 10px; z-index: 1000; text-align: left; }
        #chat-icon { width: 50px; height: 50px; background: gold; border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; box-shadow: 0 0 10px gold; font-size: 24px; color: black; }
        #chat-box { width: 300px; height: 250px; background: rgba(0,0,0,0.9); border: 2px solid gold; border-radius: 10px; display: none; flex-direction: column; padding: 10px; }
        #chat-log { flex: 1; overflow-y: auto; color: #ddd; font-size: 12px; margin-bottom: 5px; font-family: monospace; }
        #chat-input { padding: 5px; border-radius: 5px; border: none; }
    </style>
</head>
<body>
    <div id="ecran-pseudo"><h1>Roulette</h1><input type="text" id="input-pseudo" placeholder="Pseudo"><br><button class="btn" onclick="go()">JOUER</button></div>
    <div class="header">
        <button onclick="son=!son">üîä</button>
        <div class="solde-box"><span id="solde">0</span> $<div id="anim-anchor" style="position:absolute; top:20px; left:0; width:100%; height:0;"></div></div>
        <a href="/" style="color:gold;text-decoration:none;font-weight:bold;">üè† Accueil</a>
    </div>
    
    <div id="chat-wrapper"><div id="chat-box"><div id="chat-log"></div><input type="text" id="chat-input" placeholder="Message..." onkeypress="sendChat(event)"></div><div id="chat-icon" onclick="toggleChat()">üí¨</div></div>

    <div id="msg">FAITES VOS JEUX</div>
    <div class="casino-layout">
        <div class="tapis">
            <div id="blocker" style="position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:20;display:none;"></div>
            <div class="grid-num" id="grid"><div class="case zero" id="c-vert" onclick="mise('vert',0,this)">0</div></div>
            <div class="grid-out">
                <div class="case-out" onclick="mise('douzaine1',null,this)">1-12</div><div class="case-out" onclick="mise('douzaine2',null,this)">13-24</div><div class="case-out" onclick="mise('douzaine3',null,this)">25-36</div>
                <div class="case-out" style="background:#c0392b" onclick="mise('rouge',null,this)">ROUGE</div><div class="case-out" style="background:#2c3e50" onclick="mise('noir',null,this)">NOIR</div>
                <div class="case-out" onclick="mise('pair',null,this)">PAIR</div><div class="case-out" onclick="mise('impair',null,this)">IMPAIR</div>
                <div class="case-out" onclick="mise('manque',null,this)">1-18</div><div class="case-out" onclick="mise('passe',null,this)">19-36</div>
            </div>
        </div>
        <div style="width:380px;">
            <div id="timer">...</div>
            <div class="roulette-wrapper"><div class="fleche"></div><div class="roue" id="roue"></div><div class="centre" id="centre">?</div></div>
            <div class="controls">
                <div class="jeton selected" style="background:blue" onclick="sel(10,this,'blue')">10</div>
                <div class="jeton" style="background:purple" onclick="sel(50,this,'purple')">50</div>
                <div class="jeton" style="background:orange" onclick="sel(100,this,'orange')">100</div>
                <div class="jeton" style="background:red" onclick="sel('all',this,'red')">ALL</div>
            </div>
        </div>
    </div>
    <div id="live-feed"></div>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket=io(); let solde=localStorage.getItem('casino_solde')?parseInt(localStorage.getItem('casino_solde')):1000;
        let pseudo=localStorage.getItem('casino_pseudo')||"";
        document.getElementById('solde').innerText=solde;
        let miseVal=10; let colChip='blue'; let son=true;
        let pendingGain = 0; let timerGain = null;

        const ordre=[0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,30,8,23,10,5,24,16,33,1,20,14,31,9,22,18,29,7,28,12,35,3,26];
        const angle=360/37; const roue=document.getElementById('roue');
        
        if(pseudo) { document.getElementById('input-pseudo').value = pseudo; socket.emit('nouveauJoueur', pseudo); document.getElementById('ecran-pseudo').style.display = 'none'; }

        let grad=""; 
        ordre.forEach((n,i)=>{
            let c='green'; if(n!==0) c=[1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36].includes(n)?'#c0392b':'#222';
            grad+=`${c} ${i*angle}deg ${(i+1)*angle}deg, `;
            let seg=document.createElement('div'); seg.className='roue-segment'; 
            seg.style.transform=`rotate(${i*angle + angle/2}deg)`;
            let txt=document.createElement('div'); txt.className='roue-text'; txt.innerText=n;
            seg.appendChild(txt); roue.appendChild(seg);
        });
        roue.style.background=`conic-gradient(${grad.slice(0,-2)})`;

        const g=document.getElementById('grid'); const r=[1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36];
        for(let i=3;i<=36;i+=3) mkCase(i); for(let i=2;i<=35;i+=3) mkCase(i); for(let i=1;i<=34;i+=3) mkCase(i);
        function mkCase(n){ let d=document.createElement('div'); d.className='case '+(r.includes(n)?'red':'black'); d.innerText=n; d.id="c-num-"+n; d.onclick=function(){mise('numero',n,this)}; g.appendChild(d); }

        function go(){ let p=document.getElementById('input-pseudo').value; if(!p)return; localStorage.setItem('casino_pseudo',p); socket.emit('nouveauJoueur',p); document.getElementById('ecran-pseudo').style.display='none'; checkF(); }
        function checkF(){ if(solde<=0){alert("Cadeau 500$"); solde=500; upd(); animSolde(500,true); }}
        function upd(){ localStorage.setItem('casino_solde',solde); document.getElementById('solde').innerText=solde; }
        function sel(v,e,c){ miseVal=v; colChip=c; document.querySelectorAll('.jeton').forEach(b=>b.classList.remove('selected')); e.classList.add('selected'); }
        function animSolde(m, pos){ const el=document.createElement('div'); el.className='float-money'; el.innerText=(pos?'+':'')+m+'$'; el.style.color=pos?'#2ecc71':'#e74c3c'; document.getElementById('anim-anchor').appendChild(el); setTimeout(()=>el.remove(),4000); }

        function mise(t,v,e){
            let m=(miseVal==='all')?solde:miseVal;
            if(solde<=0){checkF();return;} if(m>solde)return alert('Pas assez');
            socket.emit('rouletteMiser',{type:t,valeur:v,montant:m});
            addChip(e,m,colChip);
        }
        function addChip(e,m,c,enemy,name){
            let d=document.createElement('div'); d.className=enemy?'chip chip-enemy':'chip'; d.style.backgroundColor=c;
            d.innerText=enemy?name.charAt(0):(m==solde?'ALL':m);
            d.style.transform=`translate(-50%, -50%) translate(${Math.random()*10-5}px, ${Math.random()*10-5}px)`;
            e.appendChild(d);
            if(enemy){ let l=document.getElementById('live-feed'); let x=document.createElement('div'); x.innerText=`${name} mise...`; l.prepend(x); }
        }

        socket.on('rouletteMiseConfirmee',d=>{solde-=d.montant;upd();animSolde(d.montant,false);});
        socket.on('rouletteAutreJoueurMise',d=>{ let el; if(d.type==='numero') el=document.getElementById('c-num-'+d.valeur); else if(d.type==='vert') el=document.getElementById('c-vert'); else el=document.querySelector(`.case-out[onclick*="${d.type}"]`); if(el) addChip(el,d.montant,'gray',true,d.pseudo); });
        socket.on('rouletteTimer',t=>{document.getElementById('timer').innerText=t;});
        socket.on('rouletteEtat',e=>{ 
            if(e==='RIEN_NE_VA_PLUS'){ document.getElementById('blocker').style.display='block'; document.getElementById('msg').innerText='RIEN NE VA PLUS'; document.getElementById('msg').style.color='red'; } 
            else{ document.getElementById('blocker').style.display='none'; document.getElementById('msg').innerText='FAITES VOS JEUX'; document.getElementById('msg').style.color='white'; document.querySelectorAll('.chip').forEach(c=>c.remove()); pendingGain = 0; checkF(); } 
        });

        let curRot=0;
        socket.on('rouletteResultat',d=>{
            let idx=ordre.indexOf(d.numero);
            let target=-(idx*angle)-(angle/2);
            let diff=target-(curRot%360); if(diff>0)diff-=360;
            curRot+=diff-(5*360);
            roue.style.transform=`rotate(${curRot}deg)`;
            setTimeout(()=>{
                let c=d.couleur=='rouge'?'#c0392b':(d.couleur=='noir'?'white':'#2ecc71');
                document.getElementById('centre').innerText=d.numero; document.getElementById('centre').style.color=c;
                document.getElementById('msg').innerText=`${d.numero} (${d.couleur.toUpperCase()})`; document.getElementById('msg').style.color=c;
                d.gagnants.forEach(g=>{ let l=document.getElementById('live-feed'); let x=document.createElement('div'); x.style.color='gold'; x.innerText=`üèÜ ${g.pseudo} +${g.gain}$`; l.prepend(x); });
            },5000);
        });

        socket.on('rouletteGain',g=>{ 
            if(timerGain) clearTimeout(timerGain);
            timerGain = setTimeout(() => { solde += g; upd(); animSolde(g, true); }, 5600);
        });

        function toggleChat(){ const b=document.getElementById('chat-box'); b.style.display=b.style.display==='flex'?'none':'flex'; }
        function sendChat(e){ if(e.key==='Enter'){ let i=document.getElementById('chat-input'); if(i.value.trim()) socket.emit('chatMessage', i.value); i.value=''; } }
        socket.on('chatNotification', m => { const l=document.getElementById('chat-log'); l.innerHTML+=`<div>${m}</div>`; l.scrollTop=l.scrollHeight; });
        socket.on('forceUpdateSolde', m => { solde+=parseInt(m); upd(); alert(`Re√ßu ${m}$ !`); animSolde(m, true); });
    </script>
</body>
</html>