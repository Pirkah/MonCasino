<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Texas Hold'em</title>
    <style>
        body { background: #076324; color: white; text-align: center; font-family: 'Arial', sans-serif; user-select: none; }
        .header { display: flex; justify-content: space-between; padding: 15px; background: rgba(0,0,0,0.5); }
        .poker-table { position: relative; width: 800px; height: 400px; background: radial-gradient(#27ae60, #076324); border: 15px solid #3d2b1f; border-radius: 200px; margin: 50px auto; }
        .community-cards { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); display: flex; gap: 10px; }
        .pot-display { position: absolute; top: 35%; left: 50%; transform: translate(-50%, -50%); font-size: 20px; color: gold; font-weight: bold; }
        .seat { position: absolute; width: 100px; text-align: center; }
        .seat-0 { bottom: -50px; left: 50%; transform: translateX(-50%); } 
        .seat-1 { top: 50%; right: -60px; transform: translateY(-50%); }
        .seat-2 { top: -50px; left: 50%; transform: translateX(-50%); }
        .seat-3 { top: 50%; left: -60px; transform: translateY(-50%); }
        .carte { background: white; color: black; width: 40px; height: 60px; border-radius: 5px; display: inline-flex; flex-direction: column; justify-content: center; font-weight: bold; margin: 2px; }
        .rouge { color: red; }
        .controls { position: fixed; bottom: 20px; width: 100%; display: flex; justify-content: center; gap: 10px; }
        button { padding: 10px 20px; cursor: pointer; font-weight: bold; border-radius: 5px; border: none; }
        .btn-action { background: #3498db; color: white; }
        .btn-fold { background: #e74c3c; color: white; }
    </style>
</head>
<body>
    <div class="header">
        <a href="/" style="color:gold;text-decoration:none;">üè† Accueil</a>
        <div>üí∞ <span id="solde">0</span> $</div>
    </div>

    <div id="lobby" style="margin-top:100px;">
        <button onclick="join()" style="font-size:24px; padding:20px;">S'ASSEOIR (BUY-IN 500$)</button>
    </div>

    <div class="poker-table" id="table" style="display:none;">
        <div class="pot-display">POT: <span id="pot">0</span>$</div>
        <div id="community" class="community-cards"></div>
        <div id="seats"></div>
        <button id="start-btn" onclick="socket.emit('pokerStart')" style="position:absolute; bottom:20px; left:50%; transform:translateX(-50%); display:none;">LANCER</button>
    </div>

    <div class="controls" id="ctrls" style="display:none;">
        <button class="btn-fold" onclick="act('fold')">FOLD</button>
        <button class="btn-action" id="call-btn" onclick="act('call')">CHECK/CALL</button>
        <button class="btn-action" onclick="act('allin')">ALL-IN</button>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket=io();
        let solde=0; let pseudo=localStorage.getItem('casino_pseudo');
        if(!pseudo) window.location.href="/";

        socket.emit('nouveauJoueur', pseudo);
        socket.on('initSolde', s => { solde = s; document.getElementById('solde').innerText = solde; });

        function join(){ if(solde < 500) return alert("Pas assez!"); socket.emit('pokerJoin', 500); document.getElementById('lobby').style.display='none'; document.getElementById('table').style.display='block'; }
        
        socket.on('pokerUpdate', (state) => {
            document.getElementById('pot').innerText = state.pot;
            document.getElementById('community').innerHTML = "";
            state.community.forEach(c => document.getElementById('community').appendChild(createCard(c)));

            const seats = document.getElementById('seats'); seats.innerHTML = "";
            state.players.forEach((p, i) => {
                const div = document.createElement('div'); div.className = `seat seat-${i}`;
                div.innerHTML = `<b>${p.pseudo}</b><br>${p.chips}$<br>${p.folded ? 'FOLDED' : ''}`;
                if(p.id === state.actif) div.style.color = "gold";
                seats.appendChild(div);
            });

            if(state.etat === 'ATTENTE' && state.players.length >= 2) document.getElementById('start-btn').style.display='block';
            else document.getElementById('start-btn').style.display='none';

            if(state.actif === socket.id) document.getElementById('ctrls').style.display='flex';
            else document.getElementById('ctrls').style.display='none';
        });

        socket.on('pokerHand', h => {
            const mySeat = document.querySelector('.seat-0'); // Simplifi√© pour l'exemple
            h.forEach(c => document.getElementById('table').appendChild(createCard(c)));
        });

        function act(t){ socket.emit('pokerAction', {type:t}); }
        function createCard(c){
            const d = document.createElement('div'); d.className = 'carte';
            if(['‚ô•Ô∏è','‚ô¶Ô∏è'].includes(c.symbole)) d.classList.add('rouge');
            d.innerHTML = `<span>${c.valeur}</span><span>${c.symbole}</span>`;
            return d;
        }
    </script>
</body>
</html>