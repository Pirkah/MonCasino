<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Neon Slots</title>
    <style>
        body{background:#11001c;color:white;text-align:center;font-family:Arial,sans-serif;overflow:hidden;user-select:none;}
        .slot-machine{background:#222;border:10px solid #444;border-radius:20px;width:600px;margin:30px auto;padding:30px;box-shadow:0 0 50px #d63384;}
        .reels{display:flex;justify-content:space-around;background:black;border:5px solid gold;border-radius:10px;padding:10px;height:200px;overflow:hidden;}
        .reel{font-size:80px;width:30%;height:100%;display:flex;justify-content:center;align-items:center;background:#111;border:1px solid #333;}
        .blur{filter:blur(4px);color:transparent;}
        .controls{margin-top:30px;display:flex;justify-content:center;gap:20px;align-items:center;}
        .mise{background:#333;color:white;border:2px solid #d63384;padding:10px 20px;border-radius:10px;cursor:pointer;}
        .sel{background:#d63384;transform:scale(1.1);}
        #spin{background:gold;color:black;width:100px;height:100px;border-radius:50%;font-size:24px;font-weight:bold;cursor:pointer;}
        #solde-display{font-size:24px;color:#d63384;font-weight:bold;margin:20px;}
    </style>
</head>
<body>
    <a href="/" style="color:white; float:left; margin:20px;">üè† Accueil</a>
    <div id="solde-display">üí∞ Solde : <span id="solde">0</span> $</div>
    
    <div class="slot-machine">
        <div class="reels"><div class="reel" id="r1">üçí</div><div class="reel" id="r2">7Ô∏è‚É£</div><div class="reel" id="r3">üíé</div></div>
        <div id="msg" style="font-size:30px; color:gold; margin:20px; height:40px;"></div>
        <div class="controls">
            <div class="mise sel" onclick="set(10,this)">10</div><div class="mise" onclick="set(50,this)">50</div><div class="mise" onclick="set(100,this)">100</div>
            <button id="spin" onclick="spin()">SPIN</button>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket=io();
        let solde=0; let m=10; let run=false;
        let pseudo=localStorage.getItem('casino_pseudo');
        if(!pseudo) window.location.href="/";

        socket.emit('nouveauJoueur', pseudo);
        socket.on('initSolde', s => { solde = s; document.getElementById('solde').innerText = solde; });

        function set(v,e){ if(run)return; m=v; document.querySelectorAll('.mise').forEach(b=>b.classList.remove('sel')); e.classList.add('sel');}

        function spin(){
            if(run || solde < m) return alert("Impossible de lancer");
            run=true; document.getElementById('msg').innerText="";
            let iv=[null,null,null]; const sym=['üçí','üçã','üçá','üíé','7Ô∏è‚É£'];
            [1,2,3].forEach((id,x)=>{
                iv[x]=setInterval(()=>{ document.getElementById('r'+id).innerText=sym[Math.floor(Math.random()*sym.length)]; document.getElementById('r'+id).classList.add('blur'); },50+x*20);
            });
            socket.emit('slotsSpin',m);
            socket.on('slotsResultat',d=>{
                setTimeout(()=>stop(1,d.rouleaux[0],iv),1000);
                setTimeout(()=>stop(2,d.rouleaux[1],iv),2000);
                setTimeout(()=>{stop(3,d.rouleaux[2],iv); run=false; if(d.gain>0) document.getElementById('msg').innerText=`+${d.gain}$ !`;},3000);
            });
        }
        function stop(id,s,iv){ clearInterval(iv[id-1]); let e=document.getElementById('r'+id); e.innerText=s; e.classList.remove('blur'); }
    </script>
</body>
</html>
