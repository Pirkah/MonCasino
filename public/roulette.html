<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Roulette Multi</title>
    <style>
        body{background:#1a1a1a;color:white;text-align:center;font-family:Arial,sans-serif;overflow-x:hidden;user-select:none;}
        .header{display:flex;justify-content:space-between;padding:15px;background:#111;border-bottom:2px solid gold;}
        .solde-box{font-size:24px;color:#2ecc71;font-weight:bold;position:relative;}
        .casino-layout{display:flex;justify-content:center;gap:40px;margin-top:20px;}
        .roulette-wrapper{position:relative;width:380px;height:380px; margin-top: 30px;} 
        .roue{width:100%;height:100%;border-radius:50%;border:10px solid #444;position:relative;transition:transform 5s cubic-bezier(0.1,0,0.2,1);box-shadow:0 0 30px black; overflow:hidden;}
        .fleche{position:absolute;top:-20px;left:50%;transform:translateX(-50%);border-left:20px solid transparent;border-right:20px solid transparent;border-top:40px solid gold;z-index:20;}
        .centre{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:80px;height:80px;background:#222;border-radius:50%;border:4px solid gold;display:flex;justify-content:center;align-items:center;font-size:30px;font-weight:bold;z-index:15;}
        .roue-segment { position: absolute; width: 100%; height: 100%; top: 0; left: 0; }
        .roue-text { position: absolute; top: 15px; left: 50%; transform: translateX(-50%); font-size: 14px; font-weight: bold; color: white; text-shadow: 1px 1px 2px black; }
        .tapis{background:#076324;border:8px solid #3d2b1f;border-radius:10px;padding:15px;position:relative;}
        .grid-num{display:grid;grid-template-columns:50px repeat(12,55px);gap:3px;}
        .case{display:flex;justify-content:center;align-items:center;font-weight:bold;font-size:20px;border:2px solid rgba(255,255,255,0.2);height:60px;cursor:pointer;position:relative;}
        .zero{grid-row:1/span 3;background:#16a085;} .red{background:#c0392b;} .black{background:#2c3e50;}
        .grid-out{display:grid;grid-template-columns:repeat(3,1fr);gap:5px;margin-top:10px;margin-left:53px;}
        .case-out{padding:15px;border:2px solid rgba(255,255,255,0.2);cursor:pointer;font-weight:bold;font-size:18px;position:relative;}
        .chip{position:absolute;width:30px;height:30px;border-radius:50%;border:2px dashed white;display:flex;justify-content:center;align-items:center;font-size:10px;color:black;font-weight:bold;pointer-events:none;z-index:10;top: 50%; left: 50%; margin-top: -15px; margin-left: -15px;}
        .controls{margin-top:20px;display:flex;justify-content:center;gap:20px;}
        .jeton{width:60px;height:60px;border-radius:50%;border:4px dashed white;display:flex;justify-content:center;align-items:center;font-weight:bold;cursor:pointer;}
        .selected{transform:scale(1.1);box-shadow:0 0 15px white;}
        #timer{font-size:50px;font-weight:bold;color:gold;}
        .float-money { position: absolute; font-weight: bold; font-size: 32px; animation: floatUp 4s ease-out forwards; z-index: 2000; pointer-events: none; text-shadow: 0 0 10px black; width: 300px; text-align: center; left: 50%; transform: translateX(-50%); }
        @keyframes floatUp { 0% { opacity: 1; top: 20px; transform: translateX(-50%) scale(1); } 100% { opacity: 0; top: -100px; transform: translateX(-50%) scale(1.2); } }
    </style>
</head>
<body>
    <div class="header">
        <div class="solde-box">üí∞ <span id="solde">0</span> $ <div id="anim-anchor"></div></div>
        <a href="/" style="color:gold;text-decoration:none;font-weight:bold;">üè† Accueil</a>
    </div>

    <div id="msg" style="font-size:30px; margin:10px;">CHARGEMENT...</div>
    <div id="timer">...</div>

    <div class="casino-layout">
        <div class="tapis">
            <div id="blocker" style="position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.3);z-index:20;display:none;"></div>
            <div class="grid-num" id="grid"><div class="case zero" id="c-vert" onclick="mise('vert',0,this)">0</div></div>
            <div class="grid-out">
                <div class="case-out" onclick="mise('douzaine1',null,this)">1-12</div><div class="case-out" onclick="mise('douzaine2',null,this)">13-24</div><div class="case-out" onclick="mise('douzaine3',null,this)">25-36</div>
                <div class="case-out" style="background:#c0392b" onclick="mise('rouge',null,this)">ROUGE</div><div class="case-out" style="background:#2c3e50" onclick="mise('noir',null,this)">NOIR</div>
                <div class="case-out" onclick="mise('pair',null,this)">PAIR</div><div class="case-out" onclick="mise('impair',null,this)">IMPAIR</div>
            </div>
        </div>
        <div class="roulette-wrapper">
            <div class="fleche"></div><div class="roue" id="roue"></div><div class="centre" id="centre">?</div>
            <div class="controls">
                <div class="jeton selected" style="background:blue" onclick="sel(10,this,'blue')">10</div>
                <div class="jeton" style="background:purple" onclick="sel(50,this,'purple')">50</div>
                <div class="jeton" style="background:orange" onclick="sel(100,this,'orange')">100</div>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket=io();
        let solde=0;
        let pseudo=localStorage.getItem('casino_pseudo');
        if(!pseudo) window.location.href="/";
        
        socket.emit('nouveauJoueur', pseudo);
        socket.on('initSolde', s => { solde = s; document.getElementById('solde').innerText = solde; });

        let miseVal=10; let colChip='blue';
        const ordre=[0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,30,8,23,10,5,24,16,33,1,20,14,31,9,22,18,29,7,28,12,35,3,26];
        const angle=360/37; const roue=document.getElementById('roue');

        // Tracer la roue
        let grad=""; 
        ordre.forEach((n,i)=>{
            let c= n===0 ? 'green' : ([1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36].includes(n)?'#c0392b':'#222');
            grad+=`${c} ${i*angle}deg ${(i+1)*angle}deg, `;
            let seg=document.createElement('div'); seg.className='roue-segment'; 
            seg.style.transform=`rotate(${i*angle + angle/2}deg)`;
            let txt=document.createElement('div'); txt.className='roue-text'; txt.innerText=n;
            seg.appendChild(txt); roue.appendChild(seg);
        });
        roue.style.background=`conic-gradient(${grad.slice(0,-2)})`;

        // Grille de num√©ros
        const g=document.getElementById('grid'); const r=[1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36];
        for(let i=3;i<=36;i+=3) mkCase(i); for(let i=2;i<=35;i+=3) mkCase(i); for(let i=1;i<=34;i+=3) mkCase(i);
        function mkCase(n){ 
            let d=document.createElement('div'); d.className='case '+(r.includes(n)?'red':'black'); 
            d.innerText=n; d.id="c-num-"+n; d.onclick=function(){mise('numero',n,this)}; g.appendChild(d); 
        }

        function sel(v,e,c){ miseVal=v; colChip=c; document.querySelectorAll('.jeton').forEach(b=>b.classList.remove('selected')); e.classList.add('selected'); }
        
        function mise(t,v,e){
            if(solde < miseVal) return alert("Pas assez d'argent");
            socket.emit('rouletteMiser',{type:t,valeur:v,montant:miseVal});
            let d=document.createElement('div'); d.className='chip'; d.style.backgroundColor=colChip; d.innerText=miseVal; e.appendChild(d);
        }

        socket.on('rouletteTimer',t=>{document.getElementById('timer').innerText=t;});
        socket.on('rouletteEtat',e=>{ 
            if(e==='RIEN_NE_VA_PLUS'){ document.getElementById('blocker').style.display='block'; document.getElementById('msg').innerText='RIEN NE VA PLUS'; } 
            else { 
                document.getElementById('blocker').style.display='none'; 
                document.getElementById('msg').innerText='FAITES VOS JEUX'; 
                document.querySelectorAll('.chip').forEach(c=>c.remove());
            } 
        });

        let curRot=0;
        socket.on('rouletteResultat',d=>{
            let idx=ordre.indexOf(d.numero);
            let target=-(idx*angle)-(angle/2);
            let diff=target-(curRot%360); if(diff>0)diff-=360;
            curRot+=diff-(5*360);
            roue.style.transform=`rotate(${curRot}deg)`;
            setTimeout(()=>{
                document.getElementById('centre').innerText=d.numero;
                document.getElementById('msg').innerText=`${d.numero} (${d.couleur.toUpperCase()})`;
            },5000);
        });
    </script>
</body>
</html>
